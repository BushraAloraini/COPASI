# Original Author was Kalle@kde.org
# I lifted it in some mater. (Stephan Kulow)
# I used much code from Janos Farkas

dnl Process this file with autoconf to produce a configure script.

AC_INIT(acinclude.m4) dnl a source file from your sub dir

dnl This is so we can use kde-common
AC_CONFIG_AUX_DIR(admin)

dnl Perform program name transformation
AC_ARG_PROGRAM

dnl Automake doc recommends to do this only here. (Janos)
AM_INIT_AUTOMAKE(copasi,0.1)

dnl make /usr/local the default for the installation
AC_PREFIX_DEFAULT(/usr/local)

AC_ARG_WITH([expat],
  AC_HELP_STRING([--with-expat=PATH],
                 [Path to Expat XML Library ]),
  [EXPAT_PATH=$withval])

AC_ARG_WITH([sbml],
  AC_HELP_STRING([--with-sbml=PATH],
                 [Path to SBML Library ]),
  [SBML_PATH=$withval])


AC_ARG_WITH([clapack],
  AC_HELP_STRING([--with-clapack=PATH],
                 [Path to CLAPACK Library ]),
  [CLAPACK_PATH=$withval])

AC_ARG_WITH([lapack],
  AC_HELP_STRING([--with-lapack=PATH],
                 [Path to LAPACK Library ]),
  [LAPACK_PATH=$withval])

AC_ARG_WITH([mkl],
  AC_HELP_STRING([--with-mkl=PATH],
                 [Path to MKL Library ]),
  [MKL_PATH=$withval])


AC_ARG_WITH([qwt],
  AC_HELP_STRING([--with-qwt=PATH],
                 [Path to QWT Library ]),
  [QWT_PATH=$withval])

AC_ARG_WITH([build-parser],
  AC_HELP_STRING([--with-build-parser],
                 [Specify wether to build lex and yacc sources.]),
  [BUILD_PARSER=$withval])

if test "x$prefix" = "xNONE"; then
  prefix=$ac_default_prefix
  ac_configure_args="$ac_configure_args --prefix $prefix"
fi

if test x"$BUILD_PARSER" = x"yes"; then
  prefix=$ac_default_prefix
  cps_build_parser="BUILD_PARSER=yes"
fi

if test x"${enable_release}" != x"yes" -a x"${enable_debug}" != x"no"; then
  cps_release="CONFIG+=debug CONFIG-=release"
else
  cps_release="CONFIG+=release CONFIG-=debug"
fi

if test x"${enable_thread}" != x"no"; then
  cps_thread="CONFIG+=thread"
else
  cps_thread="CONFIG-=thread"
fi

if test x"${MKL_PATH}" != x""; then
  cps_mkl_path="MKL_PATH=$MKL_PATH"
fi

if test x"${CLAPACK_PATH}" != x""; then
  cps_clapack_path="CLAPACK_PATH=$CLAPACK_PATH"
fi

if test x"${LAPACK_PATH}" != x""; then
  cps_clapack_path="LAPACK_PATH=$LAPACK_PATH"
fi

if test x"${EXPAT_PATH}" != x""; then
  cps_expat_path="EXPAT_PATH=$EXPAT_PATH"
fi

if test x"${QWT_PATH}" != x""; then
  cps_qwt_path="QWT_PATH=$QWT_PATH"
fi

if test x"${SBML_PATH}" != x""; then
  cps_sbml_path="SBML_PATH=$SBML_PATH"
fi


(
dnl to prevent calling aclocal, automake and configure again
 touch configure.in
 touch aclocal.m4 
 touch Makefile.in
 touch configure

 cd copasi && \
 echo executing in `pwd`: && \
 echo "  rm .qmake.internal.cache */.qmake.internal.cache" && \
 rm .qmake.internal.cache */.qmake.internal.cache; \
 rm Makefile */Makefile; \
 echo "  qmake $cps_release $cps_mkl_path $cps_thread $cps_clapack_path $cps_expat_path" $cps_build_parser && \
 $QTDIR/bin/qmake $cps_release $cps_thread \
                  $cps_mkl_path $cps_clapack_path $cps_expat_path $cps_qwt_path $cps_sbml_path $cps_build_parser && \
 cat Makefile | \
 sed -e 's/(MAKEFILE): *$/(MAKEFILE): Makefile/' \
     -e 'sxQMAKE.*=.*qmakexQMAKE = \$(QTDIR)/bin/qmakex'> $$.tmp && \
 mv $$.tmp Makefile && \
 echo depend:  >> Makefile && \
 echo "	touch Makefile" >> Makefile 
 cd ..
 cd semantic-test-suite && \
 echo executing in `pwd`: && \
 echo "  rm .qmake.internal.cache */.qmake.internal.cache" && \
 rm .qmake.internal.cache */.qmake.internal.cache; \
 rm Makefile */Makefile; \
 echo "  qmake $cps_release $cps_mkl_path $cps_thread $cps_clapack_path $cps_expat_path" $cps_build_parser && \
 $QTDIR/bin/qmake $cps_release $cps_thread \
                  $cps_mkl_path $cps_clapack_path $cps_expat_path $cps_qwt_path $cps_sbml_path $cps_build_parser && \
 cat Makefile | \
 sed -e 's/(MAKEFILE): *$/(MAKEFILE): Makefile/' \
     -e 'sxQMAKE.*=.*qmakexQMAKE = \$(QTDIR)/bin/qmakex'> $$.tmp && \
 mv $$.tmp Makefile && \
 echo depend:  >> Makefile && \
 echo "	touch Makefile" >> Makefile
)

dnl add here all your Makefiles. These will be created by configure
AC_OUTPUT(Makefile)
